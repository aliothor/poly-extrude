<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name=renderer content=webkit>
<script type="text/javascript" src="https://unpkg.com/turf@7.0.0-alpha.1/dist/turf.js"></script>
<script type="text/javascript" src="https://unpkg.com/gcoord@0.2.3/dist/gcoord.js"></script>
<script type="text/javascript" src="https://unpkg.com/@maptalks/geojson-bbox@1.0.4/dist/bbox.umd.js"></script>
<script type="text/javascript" src="https://unpkg.com/three@0.138.0/build/three.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/three@0.142.0/examples/js/controls/OrbitControls.js"></script>
<script type="text/javascript" src="./../dist/poly-extrude.js"></script>
<script type="text/javascript" src="./util.js"></script>

<style type="text/css">
    html,
    body {
        margin: 0px;
        height: 100%;
        width: 100%;
    }

    .container {
        width: 100%;
        height: 100%;
    }
</style>

<body>
    <script>
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xb0b0b0);
        //

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 100000);
        camera.position.set(0, 0, 200);

        //

        const directionalLight = new THREE.DirectionalLight('#fff', 1);
        directionalLight.position.set(0.75, 0.75, 1.0).normalize();
        scene.add(directionalLight);

        // const ambientLight = new THREE.AmbientLight('#FFF', 0.5);
        // scene.add(ambientLight);

        //

        const helper = new THREE.GridHelper(160, 10);
        helper.rotation.x = Math.PI / 2;
        scene.add(helper);



        //

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        //

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.minDistance = 10;
        controls.maxDistance = 1000;

        function animation() {
            requestAnimationFrame(animation);

            renderer.render(scene, camera);
        }
        animation();


        function test() {

            getGeoJSON('./data/太湖.geojson').then(geojson => {
                flatCoordinates(geojson.features[0], 100);
                const time = 'time';
                console.time(time);

                const { type, coordinates } = geojson.features[0].geometry;
                // if (type === 'Polygon') {
                //     coordinates.forEach((coords, index) => {
                //         if (index > 0) {
                //             const line = turf.lineString(coords);
                //             if (turf.booleanClockwise(line)) {
                //                 coordinates[index] = coordinates[index].reverse();
                //             }
                //         }
                //     });
                // }
                // coordinates[1] = coordinates[1].reverse();
                const result = polyextrude.extrudePolygons(type === 'Polygon' ? [coordinates] : coordinates, { depth: 2 });
                console.timeEnd(time);
                console.log(result);
                const geometry = createBufferGeometry(result);
                const mesh = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({ color: '#FFF', wireframe: false, vertexColors: true }));
                scene.add(mesh);
            })
        }
        test();



    </script>
</body>

</html>